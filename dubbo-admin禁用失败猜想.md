近日，更新项目新版本时，使用dubbo-admin禁用/启用用户登录相关customers服务（提供者），来测试新版本是否生效，遇到一些问题，记录如下。

（猜测）功能的链路模型大概是

    　—— —— —— —— —— —— >　提供者　< —— —— —— —— —— —— —— —— —— —— —— —— —— ——  消 
     
消　|　　　　　　　　　　　　　\ \　　　　　　　　　　　　　　　　　　　　　　　　　| 费

费　|　　　　提供者返回服务地址　\ \　注册中心查询提供者服务　　　　　　　　　　　　| 者

者　|　　　　　　　　　　　　　　　\ \　　　　　　　　　　　　　　　　　　　　　　　| 通

访　|　　　　　　　　　　注册中心(zookeeper集群）　　　　　　　　　　　　　　　　　| 过

问　|　　　　　　　　　　　　　　　/ /　　　　　　　　　　　　　　　　　　　　　　　| 本

提　|　　注册中心返回提供者地址　/ /　消费者向注册中心查询提供者服务　　　　　　　　| 地

供　|　　　　　　　　　　　　　/ /　　　　　　　　　　　　　　　　　　　　　　　　　| 缓

者　|　　　　　　　　　　web服务(Jboss)　　　　　　　　　　　　　　　　　　　　　　| 访

服　|　　　　　　　　　　　　|　　　　　　　　　　　　　　　　　　　　　　　　　　　| 问

务　|　　　　　　　　　　　　|　　　　　　　　　　　　　　　　　　　　　　　　　　　| 提

　　|　　　　　　　　　　　　|　　　　　　　　　　　　　　　　　　　　　　　　　　　| 供
    
      —— —— —— —— —— ——　消费者　—— ——　本地缓存(dubbo-cache)　—— —— —— —— —— —— 者
     

在新版本更新后，启用提供者服务，测试用户正常登录；随后禁用提供者服务，测试用户在2~3次登录失败后依然成功登录。但如果关停Jboss服务后再重启，则禁用设置生效，即使多次测试，测试用户也是登录失败。
在测试过程中，dubbo-admin在禁用提供者服务后，禁用未生效。猜测原理是类似于注册中心宕机，消费者从本地的dubbo缓存里取之前已经记录的提供者地址，访问提供者服务。同时，根据测试情况猜测，重启jboss服务后，消费者本地重新从注册中心获取提供者服务列表，并加入本地缓存。当提供者禁用时，注册中心不返回该提供者的服务地址，因此通过本地缓存也无法访问提供者服务。但令人奇怪的是，若原理如此，在dubbo-admin禁用再启用该提供者后，测试用户登录可立即生效，而不同于启用后禁用，禁用未生效的情况。是否此时消费者访问了注册中心，获取新的提供者地址后，加入本地缓存，进行通过地址访问；而再度禁用后，消费者仍能通过本地缓存访问提供者服务呢？dubbo-admin中的禁用服务，禁用的是提供者本身的服务，还是禁用在注册中心中被获取的授权情况呢？

测试情况如下
web(jboss) | dubbo | 提供者服务 | 测试登录情况  
-|-|-|-
start | start | 启用 | 成功
start | start | 禁用 | 成功
stop | start | 禁用 | 通讯异常
start | start | 禁用 | 失败
start | start | 启用 | 立即成功
start | start | 禁用 | 仍然成功

